# truck_ffi

Rust FFI bridge for AutoSage `cad_import_truck`.

## What it does

- Reads a STEP file (`truck-stepio` + `ruststep`)
- Converts B-rep shells into tessellated polygon triangles
- Returns flat vertex/index buffers and metadata over a C ABI

Exported C functions:

- `truck_load_step(const char *step_path, double linear_deflection)`
- `truck_free_result(TruckMeshResult *result_ptr)`

## Build

Prerequisites:

- Rust toolchain (`rustc`, `cargo`)
- `cbindgen` CLI in `PATH`

Install cbindgen:

```bash
cargo install cbindgen
```

Build release artifacts (header + static/dynamic libs):

```bash
cd Native/truck_ffi
cargo build --release
```

Generated/used outputs:

- `include/truck_ffi.h` (generated by `build.rs` through `cbindgen`)
- `target/release/libtruck_ffi.a`
- `target/release/libtruck_ffi.dylib`

## Notes

- FFI boundary is panic-safe (`catch_unwind`), and errors are returned through `TruckMeshResult.error_code` / `error_message`.
- Swift uses the dynamic library path via `AUTOSAGE_TRUCK_FFI_LIB`.
